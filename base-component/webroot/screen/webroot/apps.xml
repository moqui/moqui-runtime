<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd"
        require-authentication="false" screen-theme-type-enum-id="STT_INTERNAL" default-menu-title="Applications">

    <transition name="ScreenTree"><default-response url="../ScreenTree"/></transition>
    <transition name="setPreference">
        <parameter name="preferenceKey"/><parameter name="preferenceValue"/>
        <actions><script>ec.user.setPreference(preferenceKey, preferenceValue)</script></actions>
        <default-response type="none"/>
    </transition>
    <transition name="setPrefGoLast" read-only="true">
        <parameter name="preferenceKey"/><parameter name="preferenceValue"/>
        <actions><script>ec.user.setPreference(preferenceKey, preferenceValue)</script></actions>
        <default-response type="screen-last"/>
    </transition>
    <transition name="getPreferences" read-only="true">
        <parameter name="keyRegexp"/>
        <actions><script>ec.web.sendJsonResponse(ec.user.getPreferences(keyRegexp))</script></actions>
        <default-response type="none"/>
    </transition>
    <transition name="qzSign" read-only="true">
        <parameter name="message"/>
        <actions><script>ec.web.sendQzSignedResponse(message)</script></actions>
        <default-response type="none"/>
    </transition>

    <subscreens default-item="AppList">
    </subscreens>

    <pre-actions><script><![CDATA[
        html_scripts.add('/js/CombinedBase.min.js')
        html_scripts.add('/libs/jquery.form/jquery.form.min.js')
        html_scripts.add('/libs/jstree/jstree.min.js')

        Map validateScriptsOut = ec.service.sync().name("webroot.LocaleServices.get#ValidateLocaleScripts").call()
        if (validateScriptsOut.messagesLocation) html_scripts.add(validateScriptsOut.messagesLocation)
        if (validateScriptsOut.methodsLocation) html_scripts.add(validateScriptsOut.methodsLocation)
    ]]></script></pre-actions>

    <widgets>
        <section name="NotificationScript" condition="sri.renderMode != 'qvt2'">
            <widgets>
                <render-mode><text type="html"><![CDATA[<script>var notificationClient = new moqui.NotificationClient((location.protocol === 'https:' ? 'wss' : 'ws') + "://${ec.web.getHostName(true)}${ec.web.servletContext.contextPath}/notws");</script>]]></text></render-mode>
            </widgets>
        </section>

        <section name="TopNavSection" condition="hideNav != 'true' &amp;&amp; sri.renderMode != 'qvt2'"><widgets>
            <render-mode><text type="html"><![CDATA[
                <div id="top">
            ]]></text></render-mode>

            <render-mode><text type="html" location="component://webroot/screen/includes/navbar.html.ftl"/></render-mode>
            <subscreens-menu type="popup" id="header-menu" title="Application"/>

            <render-mode><text type="html"><![CDATA[
                </div>
                <div id="content"><div class="inner"><div class="container-fluid">
            ]]></text></render-mode>
        </widgets></section>

        <section name="MessagesSection" condition="sri.renderMode != 'qvt2'"><widgets>
            <section-iterate name="headerMessageInfos" list="ec.message.messageInfos" entry="messageInfo"><widgets>
                <render-mode><text type="html"><![CDATA[<div class="alert alert-${messageInfo.typeString} fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>]]></text></render-mode>
                <label text="${messageInfo.message}" type="h4"/>
                <render-mode><text type="html"><![CDATA[</div>]]></text></render-mode>
            </widgets></section-iterate>
            <section-iterate name="headerErrors" list="ec.message.errors" entry="errorMessage"><widgets>
                <render-mode><text type="html"><![CDATA[<div class="alert alert-danger fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>]]></text></render-mode>
                <label text="${errorMessage}" type="h4"/>
                <render-mode><text type="html"><![CDATA[</div>]]></text></render-mode>
            </widgets></section-iterate>
            <section-iterate name="headerValidationErrors" list="ec.message.validationErrors" entry="validationError"><widgets>
                <render-mode><text type="html"><![CDATA[<div class="alert alert-danger fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>]]></text></render-mode>
                <label text="${validationError.message} (for field ${validationError.fieldPretty})" type="h4"/>
                <render-mode><text type="html"><![CDATA[</div>]]></text></render-mode>
            </widgets></section-iterate>

            <section-iterate name="headerSavedMessages" list="ec.web?.savedMessages" entry="messageInfo"><widgets>
                <render-mode><text type="html"><![CDATA[<div class="alert alert-${messageInfo.typeString} fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>]]></text></render-mode>
                <label text="${messageInfo.message}" type="h4"/>
                <render-mode><text type="html"><![CDATA[</div>]]></text></render-mode>
            </widgets></section-iterate>
            <section-iterate name="headerSavedErrors" list="ec.web?.savedErrors" entry="errorMessage"><widgets>
                <render-mode><text type="html"><![CDATA[<div class="alert alert-danger fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>]]></text></render-mode>
                <label text="${errorMessage}" type="h4"/>
                <render-mode><text type="html"><![CDATA[</div>]]></text></render-mode>
            </widgets></section-iterate>
            <section-iterate name="headerSavedValidationErrors" list="ec.web?.savedValidationErrors" entry="validationError"><widgets>
                <render-mode><text type="html"><![CDATA[<div class="alert alert-danger fade in" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>]]></text></render-mode>
                <label text="${validationError.message} (for field ${validationError.fieldPretty})" type="h4"/>
                <render-mode><text type="html"><![CDATA[</div>]]></text></render-mode>
            </widgets></section-iterate>
        </widgets></section>

        <section name="SubscreenInjection">
            <widgets>
                <render-mode>
                    <text type="html"><![CDATA[<subscreens-active/>]]></text>

                    <text type="qvt2"><![CDATA[${sri.renderSubscreen()}]]></text>
                </render-mode>
            </widgets>
        </section>

        <section name="BottomNavSection" condition="hideNav != 'true' &amp;&amp; sri.renderMode != 'qvt2'"><widgets>
            <render-mode><text type="html"><![CDATA[
                </div></div></div>

                <div id="footer" class="bg-dark">
                    <#assign footerItemList = sri.getThemeValues("STRT_FOOTER_ITEM")>
                    <div id="apps-footer-content">
                        <#list footerItemList! as footerItem>
                            <#assign footerItemTemplate = footerItem?interpret>
                            <@footerItemTemplate/>
                        </#list>
                    </div>
                </div>
            ]]></text></render-mode>
        </widgets></section>
    </widgets>
</screen>